"use strict";(self.webpackChunkjavascript_parser_in_rust=self.webpackChunkjavascript_parser_in_rust||[]).push([[75],{4826:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>o});var s=r(1527),t=r(7660);const i={id:"errors",title:"\u5904\u7406\u9519\u8bef"},c=void 0,l={id:"errors",title:"\u5904\u7406\u9519\u8bef",description:"\u4ee5\u4e0b\u5f15\u7528\u81ea \u9f99\u4e66\uff1a",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/errors.md",sourceDirName:".",slug:"/errors",permalink:"/javascript-parser-in-rust/zh/docs/errors",draft:!1,unlisted:!1,editUrl:"https://github.com/oxc-project/javascript-parser-in-rust/tree/main/docs/errors.md",tags:[],version:"current",frontMatter:{id:"errors",title:"\u5904\u7406\u9519\u8bef"},sidebar:"tutorialSidebar",previous:{title:"\u89e3\u6790\u5668 (Parser)",permalink:"/javascript-parser-in-rust/zh/docs/parser"},next:{title:"\u8bed\u4e49\u5206\u6790 (Semantic Analysis)",permalink:"/javascript-parser-in-rust/zh/docs/semantics_analysis"}},d={},o=[{value:"<code>Error</code> Trait",id:"error-trait",level:3},{value:"\u7cbe\u7f8e\u7684\u9519\u8bef\u62a5\u544a",id:"\u7cbe\u7f8e\u7684\u9519\u8bef\u62a5\u544a",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",img:"img",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u5f15\u7528\u81ea ",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Compilers-Principles-Techniques-Tools-2nd/dp/0321486811",children:"\u9f99\u4e66"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u89c4\u8303\u5e76\u672a\u63cf\u8ff0\u7f16\u8bd1\u5668\u5e94\u8be5\u5982\u4f55\u54cd\u5e94\u9519\u8bef\uff1b\u9519\u8bef\u5904\u7406\u7559\u7ed9\u4e86\u7f16\u8bd1\u5668\u8bbe\u8ba1\u8005\u3002\n\u4ece\u4e00\u5f00\u59cb\u5c31\u89c4\u5212\u9519\u8bef\u5904\u7406\u4e0d\u4ec5\u53ef\u4ee5\u7b80\u5316\u7f16\u8bd1\u5668\u7684\u7ed3\u6784\uff0c\u8fd8\u80fd\u6539\u5584\u5176\u9519\u8bef\u5904\u7406\u80fd\u529b\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u65e0\u8bba\u6211\u4eec\u8f93\u5165\u4ec0\u4e48\u6837\u7684\u5185\u5bb9\uff0c\u4e00\u4e2a\u5b8c\u5168\u53ef\u6062\u590d (fully recoverable) \u7684\u89e3\u6790\u5668\u90fd\u80fd\u6784\u5efa\u51fa AST\u3002\n\u5bf9\u4e8e\u4ee3\u7801\u68c0\u67e5\u5668\u6216\u683c\u5f0f\u5316\u5668\u4e4b\u7c7b\u7684\u5de5\u5177\uff0c\u4eba\u4eec\u5e0c\u671b\u6709\u4e00\u4e2a\u5b8c\u5168\u53ef\u6062\u590d\u7684\u89e3\u6790\u5668\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4ec5\u4ec5\u5904\u7406\u7a0b\u5e8f\u7684\u4e00\u5c0f\u90e8\u5206\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u65e6\u53d1\u73b0\u8bed\u6cd5\u4e0d\u5339\u914d\uff0c\u4e00\u4e2a\u5d29\u6e83\u7684\u89e3\u6790\u5668\u5c06\u4e2d\u6b62\uff0c\u800c\u4e00\u4e2a\u90e8\u5206\u53ef\u6062\u590d\u7684 (partially recoverable)\u89e3\u6790\u5668\u5c06\u4ece\u786e\u5b9a\u6027\u8bed\u6cd5\u4e2d\u6062\u590d\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u8bed\u6cd5\u9519\u8bef\u7684 while \u8bed\u53e5 ",(0,s.jsx)(n.code,{children:"while true {}"}),"\uff0c\u6211\u4eec\u77e5\u9053\u5b83\u7f3a\u5c11\u5706\u62ec\u53f7\uff0c\u800c\u5b83\u552f\u4e00\u53ef\u80fd\u7684\u6807\u70b9\u7b26\u53f7\u5c31\u662f\u5706\u62ec\u53f7\uff0c\u56e0\u6b64\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u6709\u6548\u7684 AST\uff0c\u5e76\u6307\u793a\u5176\u7f3a\u5c11\u7684\u62ec\u53f7\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u76ee\u524d\u5927\u591a\u6570 JavaScript \u89e3\u6790\u5668\u90fd\u662f\u90e8\u5206\u53ef\u6062\u590d\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u5c06\u6784\u5efa\u4e00\u4e2a\u90e8\u5206\u53ef\u6062\u590d\u7684\u89e3\u6790\u5668\u3002"}),"\n",(0,s.jsxs)(n.p,{children:[":::\u4fe1\u606f\n",(0,s.jsx)(n.a,{href:"https://github.com/rome/tools",children:"Rome"})," \u89e3\u6790\u5668\u662f\u4e00\u4e2a\u5b8c\u5168\u53ef\u6062\u590d\u7684\u89e3\u6790\u5668\u3002\n:::"]}),"\n",(0,s.jsxs)(n.p,{children:["Rust \u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"Result"})," \u7c7b\u578b\u6765\u8fd4\u56de\u548c\u4f20\u64ad\u9519\u8bef\u3002\n\u914d\u5408 ",(0,s.jsx)(n.code,{children:"?"})," \u8bed\u6cd5\uff0c\u89e3\u6790\u51fd\u6570\u5c06\u4fdd\u6301\u7b80\u5355\u6e05\u6670\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u901a\u5e38\u4f1a\u5c01\u88c5 Result \u7c7b\u578b\uff0c\u4ee5\u4fbf\u7a0d\u540e\u66ff\u6362\u9519\u8bef\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub type Result<T> = std::result::Result<T, ()>;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u7684\u89e3\u6790\u51fd\u6570\u5c06\u8fd4\u56de\u4e00\u4e2a Result\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub fn parse_binding_pattern(&mut self, ctx: Context) -> Result<BindingPattern<'a>> {\n    match self.cur_kind() {\n        Kind::LCurly => self.parse_object_binding_pattern(ctx),\n        Kind::LBrack => self.parse_array_binding_pattern(ctx),\n        kind if kind.is_binding_identifier() => {\n          // ... \u4ee3\u7801\u7701\u7565\n        }\n        // highlight-next-line\n        _ => Err(()),\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"expect"})," \u51fd\u6570\uff0c\u7528\u4e8e\u5728\u5f53\u524d\u6807\u8bb0\u4e0e\u8bed\u6cd5\u4e0d\u5339\u914d\u65f6\u8fd4\u56de\u9519\u8bef\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// \u671f\u671b\u4e00\u4e2a `Kind` \u6216\u8fd4\u56de\u9519\u8bef\npub fn expect(&mut self, kind: Kind) -> Result<()> {\n    if !self.at(kind) {\n        return Err(())\n    }\n    self.advance();\n    Ok(())\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5e76\u5982\u6b64\u4f7f\u7528\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub fn parse_paren_expression(&mut self, ctx: Context) -> Result<Expression> {\n    self.expect(Kind::LParen)?;\n    let expression = self.parse_expression(ctx)?;\n    self.expect(Kind::RParen)?;\n    Ok(expression)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:":::\u6ce8\u610f"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u5b8c\u6574\u8d77\u89c1\uff0c\u8bcd\u6cd5\u5206\u6790\u51fd\u6570 ",(0,s.jsx)(n.code,{children:"read_next_token"})," \u5728\u8bcd\u6cd5\u5206\u6790\u65f6\u53d1\u73b0\u610f\u5916\u7684 ",(0,s.jsx)(n.code,{children:"char"})," \u65f6\u4e5f\u5e94\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"Result"}),"\u3002\n:::"]}),"\n",(0,s.jsxs)(n.h3,{id:"error-trait",children:[(0,s.jsx)(n.code,{children:"Error"})," Trait"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u8fd4\u56de\u4e00\u79cd\u7279\u5b9a\u7684\u9519\u8bef\uff0c\u6211\u4eec\u9700\u8981\u586b\u4e0a ",(0,s.jsx)(n.code,{children:"Result"})," \u7684 ",(0,s.jsx)(n.code,{children:"Err"})," \u90e8\u5206\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub type Result<T> = std::result::Result<T, SyntaxError>;\n                                            ^^^^^^^^^^^\n#[derive(Debug)]\npub enum SyntaxError {\n    UnexpectedToken(String),\n    AutoSemicolonInsertion(String),\n    UnterminatedMultiLineComment(String),\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u79f0\u4e4b\u4e3a ",(0,s.jsx)(n.code,{children:"SyntaxError"}),'\uff0c\u56e0\u4e3a\u5728 ECMAScript \u89c4\u8303\u7684\u8bed\u6cd5\u90e8\u5206\u91cc\u5b9a\u4e49\u7684\u6240\u6709"\u65e9\u671f\u9519\u8bef (early errors)"\u90fd\u662f\u8bed\u6cd5\u9519\u8bef\u3002']}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u4f7f\u5176\u6210\u4e3a\u4e00\u4e2a\u5408\u9002\u7684 ",(0,s.jsx)(n.code,{children:"Error"}),"\uff0c\u5b83\u9700\u8981\u5b9e\u73b0 ",(0,s.jsxs)(n.a,{href:"https://doc.rust-lang.org/std/error/trait.Error.html",children:[(0,s.jsx)(n.code,{children:"Error"})," trait"]}),"\u3002\u4e3a\u4e86\u4f7f\u4ee3\u7801\u66f4\u6e05\u6670\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(n.a,{href:"https://docs.rs/thiserror/latest/thiserror",children:(0,s.jsx)(n.code,{children:"thiserror"})})," crate \u4e2d\u7684\u5b8f\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug, Error)]\npub enum SyntaxError {\n    #[error("Unexpected Token")]\n    UnexpectedToken,\n\n    #[error("Expected a semicolon or an implicit semicolon after a statement, but found none")]\n    AutoSemicolonInsertion,\n\n    #[error("Unterminated multi-line comment")]\n    UnterminatedMultiLineComment,\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"expect"})," \u8f85\u52a9\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u6807\u8bb0\u4e0d\u5339\u914d\u65f6\u629b\u51fa\u9519\u8bef\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// \u671f\u671b\u4e00\u4e2a `Kind` \u6216\u8fd4\u56de\u9519\u8bef\npub fn expect(&mut self, kind: Kind) -> Result<()> {\n    if self.at(kind) {\n        return Err(SyntaxError::UnExpectedToken);\n    }\n    self.advance(kind);\n    Ok(())\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"parse_debugger_statement"})," \u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"expect"})," \u51fd\u6570\u8fdb\u884c\u9002\u5f53\u7684\u9519\u8bef\u7ba1\u7406\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"fn parse_debugger_statement(&mut self) -> Result<Statement> {\n    let node = self.start_node();\n    self.expect(Kind::Debugger)?;\n    Ok(Statement::DebuggerStatement {\n        node: self.finish_node(node),\n    })\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"expect"})," \u540e\u9762\u7684 ",(0,s.jsx)(n.code,{children:"?"})," \u662f\u4e00\u79cd\u8bed\u6cd5\u7cd6\uff0c\u79f0\u4e3a ",(0,s.jsx)(n.a,{href:"https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html#a-shortcut-for-propagating-errors-the--operator",children:'"\u95ee\u53f7\u64cd\u4f5c\u7b26"'}),"\uff0c\u7528\u4e8e\u4f7f\u51fd\u6570\u5728 ",(0,s.jsx)(n.code,{children:"expect"})," \u8fd4\u56de ",(0,s.jsx)(n.code,{children:"Err"})," \u65f6\u63d0\u524d\u8fd4\u56de\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u7cbe\u7f8e\u7684\u9519\u8bef\u62a5\u544a",children:"\u7cbe\u7f8e\u7684\u9519\u8bef\u62a5\u544a"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://docs.rs/miette/latest/miette",children:(0,s.jsx)(n.code,{children:"miette"})})," \u662f\u5176\u4e2d\u4e00\u4e2a\u6700\u597d\u7684\u9519\u8bef\u62a5\u544a crate\uff0c\u5b83\u63d0\u4f9b\u4e86\u7cbe\u7f8e\u7684\u5f69\u8272\u8f93\u51fa\uff1a"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/zkat/miette/main/images/serde_json.png",alt:"miette"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5c06 ",(0,s.jsx)(n.code,{children:"miette"})," \u6dfb\u52a0\u5230\u4f60\u7684 ",(0,s.jsx)(n.code,{children:"Cargo.toml"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nmiette = { version = "5", features = ["fancy"] }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u7528 ",(0,s.jsx)(n.code,{children:"miette"})," \u5305\u88c5\u6211\u4eec\u7684 ",(0,s.jsx)(n.code,{children:"Error"}),"\uff0c\u800c\u4e0d\u4fee\u6539\u6211\u4eec\u7684\u89e3\u6790\u5668\u4e2d\u5b9a\u4e49\u7684 ",(0,s.jsx)(n.code,{children:"Result"})," \u7c7b\u578b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'pub fn main() -> Result<()> {\n    let source_code = "".to_string();\n    let file_path = "test.js".to_string();\n    let mut parser = Parser::new(&source_code);\n    parser.parse().map_err(|error| {\n        miette::Error::new(error).with_source_code(miette::NamedSource::new(file_path, source_code))\n    })\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},7660:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>c});var s=r(959);const t={},i=s.createContext(t);function c(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);