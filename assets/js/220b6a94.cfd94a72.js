"use strict";(self.webpackChunkjavascript_parser_in_rust=self.webpackChunkjavascript_parser_in_rust||[]).push([[983],{1985:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var i=t(1527),s=t(7660);const r={title:"The ECMAScript Specification"},a=void 0,o={permalink:"/javascript-parser-in-rust/blog/ecma-spec",editUrl:"https://github.com/oxc-project/javascript-parser-in-rust/tree/main/blog/ecma-spec.md",source:"@site/blog/ecma-spec.md",title:"The ECMAScript Specification",description:"The ECMAScript\xae 2023 Language Specification details everything about the JavaScript language, so anyone can implement their own JavaScript engine.",date:"2023-11-12T16:10:41.000Z",formattedDate:"November 12, 2023",tags:[],readingTime:3,hasTruncateMarker:!0,authors:[],frontMatter:{title:"The ECMAScript Specification"},unlisted:!1,prevItem:{title:"Grammar",permalink:"/javascript-parser-in-rust/blog/grammar"},nextItem:{title:"Conformance Tests",permalink:"/javascript-parser-in-rust/blog/conformance"}},c={authorsImageUrls:[]},l=[{value:"Notational Conventions",id:"notational-conventions",level:2},{value:"Recursion",id:"recursion",level:3},{value:"Optional",id:"optional",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Source Text",id:"source-text",level:2},{value:"ECMAScript Language: Lexical Grammar",id:"ecmascript-language-lexical-grammar",level:2},{value:"Automatic Semicolon Insertion",id:"automatic-semicolon-insertion",level:3},{value:"Expressions, Statements, Functions, Classes, Scripts and Modules",id:"expressions-statements-functions-classes-scripts-and-modules",level:2},{value:"Annex B",id:"annex-b",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://tc39.es/ecma262/",children:"The ECMAScript\xae 2023 Language Specification"})," details everything about the JavaScript language, so anyone can implement their own JavaScript engine."]}),"\n",(0,i.jsx)(n.p,{children:"The following chapters need to be studied for our parser:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Chapter 5: Notational Conventions"}),"\n",(0,i.jsx)(n.li,{children:"Chapter 11: ECMAScript Language: Source Text"}),"\n",(0,i.jsx)(n.li,{children:"Chapter 12: ECMAScript Language: Lexical Grammar"}),"\n",(0,i.jsx)(n.li,{children:"Chapter 13 - 16: Expressions, Statements, Functions, Classes, Scripts and Modules"}),"\n",(0,i.jsx)(n.li,{children:"Annex B: Additional ECMAScript Features for Web Browsers"}),"\n",(0,i.jsx)(n.li,{children:"Annex C: The Strict Mode of ECMAScript"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For navigation inside the specification:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Anything clickable has a permanent link, they are shown on the URL as anchors, for example ",(0,i.jsx)(n.code,{children:"#sec-identifiers"})]}),"\n",(0,i.jsxs)(n.li,{children:["Hovering over things may show a tooltip, clicking on ",(0,i.jsx)(n.code,{children:"References"})," shows all its references"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"notational-conventions",children:"Notational Conventions"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://tc39.es/ecma262/#sec-grammar-notation",children:"Chapter 5.1.5 Grammar Notation"})," is the section we need to read."]}),"\n",(0,i.jsx)(n.p,{children:"The things to note here are:"}),"\n",(0,i.jsx)(n.h3,{id:"recursion",children:"Recursion"}),"\n",(0,i.jsx)(n.p,{children:"This is how lists are presented in the grammar."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markup",children:"ArgumentList :\n  AssignmentExpression\n  ArgumentList , AssignmentExpression\n"})}),"\n",(0,i.jsx)(n.p,{children:"means"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"a, b = 1, c = 2\n^_____________^ ArgumentList\n   ^__________^ ArgumentList, AssignmentExpression,\n          ^___^ AssignmentExpression\n"})}),"\n",(0,i.jsx)(n.h3,{id:"optional",children:"Optional"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"_opt_"})," suffix for optional syntax. For example,"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markup",children:"VariableDeclaration :\n  BindingIdentifier Initializer_opt\n"})}),"\n",(0,i.jsx)(n.p,{children:"means"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"var binding_identifier;\nvar binding_identifier = Initializer;\n                       ______________ Initializer_opt\n"})}),"\n",(0,i.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"[Return]"})," and ",(0,i.jsx)(n.code,{children:"[In]"})," are parameters of the grammar."]}),"\n",(0,i.jsx)(n.p,{children:"For example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdup",children:"ScriptBody :\n    StatementList[~Yield, ~Await, ~Return]\n"})}),"\n",(0,i.jsx)(n.p,{children:"means top-level yield, await and return are not allowed in scripts, but"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdup",children:"ModuleItem :\n  ImportDeclaration\n  ExportDeclaration\n  StatementListItem[~Yield, +Await, ~Return]\n"})}),"\n",(0,i.jsx)(n.p,{children:"allows for top-level await."}),"\n",(0,i.jsx)(n.h2,{id:"source-text",children:"Source Text"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://tc39.es/ecma262/#sec-types-of-source-code",children:"Chapter 11.2 Types of Source Code"})," tells us that\nthere is a huge distinction between script code and module code.\nAnd there is a ",(0,i.jsx)(n.code,{children:"use strict"})," mode that makes the grammar saner by disallowing old JavaScript behaviors."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Script Code"})," is not strict, ",(0,i.jsx)(n.code,{children:"use strict"})," need to be inserted at the top of the file to make script code strict.\nIn html we write ",(0,i.jsx)(n.code,{children:'<script src="javascript.js"><\/script>'}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Module Code"})," is automatically strict.\nIn html we write ",(0,i.jsx)(n.code,{children:'<script type="module" src="main.mjs"><\/script>'}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"ecmascript-language-lexical-grammar",children:"ECMAScript Language: Lexical Grammar"}),"\n",(0,i.jsxs)(n.p,{children:["For more in-depth explanation, read the V8 blog on ",(0,i.jsx)(n.a,{href:"https://v8.dev/blog/understanding-ecmascript-part-3",children:"Understanding the ECMAScript spec"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"automatic-semicolon-insertion",children:(0,i.jsx)(n.a,{href:"https://tc39.es/ecma262/#sec-automatic-semicolon-insertion",children:"Automatic Semicolon Insertion"})}),"\n",(0,i.jsx)(n.p,{children:"This section describes all the rules where we can omit a semicolon while writing JavaScript.\nAll the explanation boils down to"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"    pub fn asi(&mut self) -> Result<()> {\n        if self.eat(Kind::Semicolon) || self.can_insert_semicolon() {\n            return Ok(());\n        }\n        let range = self.prev_node_end..self.cur_token().start;\n        Err(SyntaxError::AutoSemicolonInsertion(range.into()))\n    }\n\n    pub const fn can_insert_semicolon(&self) -> bool {\n        self.cur_token().is_on_new_line || matches!(self.cur_kind(), Kind::RCurly | Kind::Eof)\n    }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"asi"})," function need to be manually called where applicable, for example in the end of statement:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"    fn parse_debugger_statement(&mut self) -> Result<Statement<'a>> {\n        let node = self.start_node();\n        self.expect(Kind::Debugger)?;\n        // highlight-next-line\n        self.asi()?;\n        self.ast.debugger_statement(self.finish_node(node))\n    }\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["This section on asi is written with a parser in mind,\nit explicitly states that the source text is parsed from left to right,\nwhich makes it almost impossible to write the parser in any other way.\nThe author of jsparagus made a rant about this ",(0,i.jsx)(n.a,{href:"https://github.com/mozilla-spidermonkey/jsparagus/blob/master/js-quirks.md#automatic-semicolon-insertion-",children:"here"}),"."]}),(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"The specification for this feature is both very-high-level and weirdly procedural (\u201cWhen, as the source text is parsed from left to right, a token is encountered...\u201d, as if the specification is telling a story about a browser. As far as I know, this is the only place in the spec where anything is assumed or implied about the internal implementation details of parsing.) But it would be hard to specify ASI any other way."}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"expressions-statements-functions-classes-scripts-and-modules",children:"Expressions, Statements, Functions, Classes, Scripts and Modules"}),"\n",(0,i.jsxs)(n.p,{children:["It takes a while to understand the syntactic grammar, then apply them to writing a parser.\nMore in-depth content can be found in ",(0,i.jsx)(n.a,{href:"./blog/grammar",children:"the grammar tutorial"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"annex-b",children:"Annex B"})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},7660:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>a});var i=t(959);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);